# Terraform Importer

Terraform Importer is a standalone utility to import existing infrastructure
into a Terraform state, based on existing Terraform configs. Its target use-case
is to facilitate migration between other infrastructure-as-code tools (such as
[Deployment Manager](https://cloud.google.com/deployment-manager)), and configs
generated by the Terrarom Engine.

## Requirements

- [Terraform 0.14.8](https://releases.hashicorp.com/terraform/) (consistent
    with the version of Terraform used by CICD)
- [Go 1.14+](https://golang.org/dl/)

## Installation

Download a pre-built
[tfimport binary](https://github.com/GoogleCloudPlatform/healthcare-data-protection-suite/releases/):

```shell
VERSION=v0.8.0
wget -O /usr/local/bin/tfimport https://github.com/GoogleCloudPlatform/healthcare-data-protection-suite/releases/download/${VERSION}/tfimport_${VERSION}_linux-amd64
chmod +x /usr/local/bin/tfimport
```

or build it yourself:

```shell
git clone https://github.com/GoogleCloudPlatform/healthcare-data-protection-suite
cd healthcare-data-protection-suite
go install ./cmd/tfimport
```

## Usage

Enter the directory containing Terraform configs:

```shell
cd ~/path/to/terraform/configs/
```

Run the importer:

```shell
tfimport
```

On a successful run, the Terraform configs in the current working directory
will be initialized and all supported resources will be in the state.

If you now run `terraform plan`, you should only see planned changes for
differences between the configs and the actual infrastructure.

### Flags

```shell
$ tfimport -h
Usage:
  -dry_run bool
        Run in dry-run mode, which only prints the import commands
        without running them.
  -input_dir string
        Path to the directory containing Terraform configs. (default ".")
  -interactive bool
        Interactively ask for user input when import information cannot be
        automatically determined. (default true)
  -resource_types string
        Specific resource types to import, specified as terraform resource
        names (e.g. 'google_storage_bucket', 'google_resource_manager_lien').
        Provide flag multiple times for multiple values.
        Leave empty to import all. (default {})
  -terraform_path string
        Name or path to the terraform binary to use. (default "terraform")
  -version bool
        show version and exit
```

## Limitations

### Unknown Fields

Sometimes, fields required for import will not be known at plan time. This generally
falls into a few cases:

1. Another resource must be imported first. The importer will keep trying to
   plan-and-import as long as it makes progress (i.e. successfully imports some resources,
   but not all).
2. Unknowable fields, including all `random_*` resources and `google_folder`.
   In this case, the importer will ask the user to input the value. Where
   possible, it will offer a choice as well.

## Related Tools

### Terraformer

This tool is complementary to
[Terraformer](https://github.com/GoogleCloudPlatform/terraformer).

Terraformer focuses on generating new Terraform configs from existing
infrastructure, while the Importer allows you to define and organize your own
Terraform configs, including importing resources from within modules.

## Resource Support by Provider

### [Google Cloud Platform (GCP)](https://www.terraform.io/docs/providers/google/index.html)

- AppEngine
  - [`google_app_engine_application`](https://www.terraform.io/docs/providers/google/r/app_engine_application.html)
- BigQuery
  - [`google_bigquery_dataset`](https://www.terraform.io/docs/providers/google/r/bigquery_dataset.html)
  - [`google_bigquery_table`](https://www.terraform.io/docs/providers/google/r/bigquery_table.html)
  - **Unimportable**:
    - [`google_bigquery_dataset_access`](https://www.terraform.io/docs/providers/google/r/bigquery_dataset_access.html)
- Billing
  - [`google_billing_budget`](https://www.terraform.io/docs/providers/google/r/billing_budget.html)
- Binary Authorization
  - [`google_binary_authorization_policy`](https://www.terraform.io/docs/providers/google/r/binary_authorization_policy.html)
- Cloud Build
  - [`google_cloudbuild_trigger`](https://www.terraform.io/docs/providers/google/r/cloudbuild_trigger.html)
- Cloud (Stackdriver) Logging
  - [`google_logging_billing_account_sink`](https://www.terraform.io/docs/providers/google/r/logging_billing_account_sink.html)
  - [`google_logging_folder_sink`](https://www.terraform.io/docs/providers/google/r/logging_folder_sink.html)
  - [`google_logging_organization_sink`](https://www.terraform.io/docs/providers/google/r/logging_organization_sink.html)
  - [`google_logging_project_sink`](https://www.terraform.io/docs/providers/google/r/logging_project_sink.html)
- Cloud DNS
  - [`google_dns_managed_zone`](https://www.terraform.io/docs/providers/google/r/dns_managed_zone.html)
  - [`google_dns_record_set`](https://www.terraform.io/docs/providers/google/r/dns_record_set.html)
- Cloud Key Management Service
  - [`google_kms_key_ring`](https://www.terraform.io/docs/providers/google/r/kms_key_ring.html)
- Cloud Platform
  - [`google_billing_account_iam_binding`](https://www.terraform.io/docs/providers/google/r/google_billing_account_iam_binding.html)
  - [`google_billing_account_iam_member`](https://www.terraform.io/docs/providers/google/r/google_billing_account_iam_member.html)
  - [`google_billing_account_iam_policy`](https://www.terraform.io/docs/providers/google/r/google_billing_account_iam_policy.html)
  - [`google_folder`](https://www.terraform.io/docs/providers/google/r/google_folder.html)
  - [`google_folder_iam_binding`](https://www.terraform.io/docs/providers/google/r/google_folder_iam_binding.html)
  - [`google_folder_iam_member`](https://www.terraform.io/docs/providers/google/r/google_folder_iam_member.html)
  - [`google_folder_iam_policy`](https://www.terraform.io/docs/providers/google/r/google_folder_iam_policy.html)
  - [`google_folder_organization_policy`](https://www.terraform.io/docs/providers/google/r/google_folder_organization_policy.html)
  - [`google_organization_iam_audit_config`](https://www.terraform.io/docs/providers/google/r/google_organization_iam_audit_config.html)
  - [`google_organization_iam_custom_role`](https://www.terraform.io/docs/providers/google/r/google_organization_iam_custom_role.html)
  - [`google_organization_iam_member`](https://www.terraform.io/docs/providers/google/r/google_organization_iam_member.html)
  - [`google_organization_policy`](https://www.terraform.io/docs/providers/google/r/google_organization_policy.html)
  - [`google_project`](https://www.terraform.io/docs/providers/google/r/google_project.html)
  - [`google_project_iam_binding`](https://www.terraform.io/docs/providers/google/r/google_project_iam.html#google_project_iam_binding-1)
  - [`google_project_iam_custom_role`](https://www.terraform.io/docs/providers/google/r/google_project_iam_custom_role.html)
  - [`google_project_iam_member`](https://www.terraform.io/docs/providers/google/r/google_project_iam.html#google_project_iam_member-1)
  - [`google_project_organization_policy`](https://www.terraform.io/docs/providers/google/r/google_project_organization_policy.html)
  - [`google_project_service`](https://www.terraform.io/docs/providers/google/r/google_project_service.html)
  - [`google_project_usage_export_bucket`](https://www.terraform.io/docs/providers/google/r/usage_export_bucket.html)
  - [`google_service_account`](https://www.terraform.io/docs/providers/google/r/google_service_account.html)
  - [`google_service_account_iam_binding`](https://www.terraform.io/docs/providers/google/r/google_service_account_iam.html)
  - [`google_service_account_iam_member`](https://www.terraform.io/docs/providers/google/r/google_service_account_iam.html)
  - [`google_service_account_iam_policy`](https://www.terraform.io/docs/providers/google/r/google_service_account_iam.html)
  - **Unimportable**:
    - [`google_service_account_key`](https://www.terraform.io/docs/providers/google/r/google_service_account_key.html)
- Cloud Pub/Sub
  - [`google_pubsub_subscription`](https://www.terraform.io/docs/providers/google/r/pubsub_subscription.html)
  - [`google_pubsub_subscription_iam_binding`](https://www.terraform.io/docs/providers/google/r/pubsub_subscription_iam.html)
  - [`google_pubsub_subscription_iam_member`](https://www.terraform.io/docs/providers/google/r/pubsub_subscription_iam.html)
  - [`google_pubsub_subscription_iam_policy`](https://www.terraform.io/docs/providers/google/r/pubsub_subscription_iam.html)
  - [`google_pubsub_topic`](https://www.terraform.io/docs/providers/google/r/pubsub_topic.html)
  - [`google_pubsub_topic_iam_binding`](https://www.terraform.io/docs/providers/google/r/pubsub_topic_iam.html)
  - [`google_pubsub_topic_iam_member`](https://www.terraform.io/docs/providers/google/r/pubsub_topic_iam.html)
  - [`google_pubsub_topic_iam_policy`](https://www.terraform.io/docs/providers/google/r/pubsub_topic_iam.html)
- Cloud SQL
  - [`google_sql_database`](https://www.terraform.io/docs/providers/google/r/sql_database.html)
  - [`google_sql_database_instance`](https://www.terraform.io/docs/providers/google/r/sql_database_instance.html)
  - [`google_sql_user`](https://www.terraform.io/docs/providers/google/r/sql_user.html)
- Cloud Storage
  - [`google_storage_bucket`](https://www.terraform.io/docs/providers/google/r/storage_bucket.html)
  - [`google_storage_bucket_iam_binding`](https://www.terraform.io/docs/providers/google/r/storage_bucket_iam.html)
  - [`google_storage_bucket_iam_member`](https://www.terraform.io/docs/providers/google/r/storage_bucket_iam.html)
  - [`google_storage_bucket_iam_policy`](https://www.terraform.io/docs/providers/google/r/storage_bucket_iam.html)
  - **Unimportable**:
    - [`google_storage_bucket_object`](https://www.terraform.io/docs/providers/google/r/storage_bucket_object.html)
- Compute Engine
  - [`google_compute_address`](https://www.terraform.io/docs/providers/google/r/compute_address.html)
  - [`google_compute_firewall`](https://www.terraform.io/docs/providers/google/r/compute_firewall.html)
  - [`google_compute_forwarding_rule`](https://www.terraform.io/docs/providers/google/r/compute_forwarding_rule.html)
  - [`google_compute_global_address`](https://www.terraform.io/docs/providers/google/r/compute_global_address.html)
  - [`google_compute_health_check`](https://www.terraform.io/docs/providers/google/r/compute_health_check.html)
  - [`google_compute_image`](https://www.terraform.io/docs/providers/google/r/compute_image.html)
  - [`google_compute_instance`](https://www.terraform.io/docs/providers/google/r/compute_instance.html)
  - [`google_compute_instance_template`](https://www.terraform.io/docs/providers/google/r/compute_instance_template.html)
  - [`google_compute_instance_from_template`](https://www.terraform.io/docs/providers/google/r/compute_instance_from_template.html)
  - [`google_compute_interconnect_attachment`](https://www.terraform.io/docs/providers/google/r/compute_interconnect_attachment.html)
  - [`google_compute_network`](https://www.terraform.io/docs/providers/google/r/compute_network.html)
  - [`google_compute_network_peering`](https://www.terraform.io/docs/providers/google/r/compute_network_peering.html)
  - [`google_compute_project_metadata_item`](https://www.terraform.io/docs/providers/google/r/compute_project_metadata_item.html)
  - [`google_compute_region_backend_service`](https://www.terraform.io/docs/providers/google/r/compute_region_backend_service.html)
  - [`google_compute_route`](https://www.terraform.io/docs/providers/google/r/compute_route.html)
  - [`google_compute_router`](https://www.terraform.io/docs/providers/google/r/compute_router.html)
  - [`google_compute_router_interface`](https://www.terraform.io/docs/providers/google/r/compute_router_interface.html)
  - [`google_compute_router_nat`](https://www.terraform.io/docs/providers/google/r/compute_router_nat.html)
  - [`google_compute_router_peer`](https://www.terraform.io/docs/providers/google/r/compute_router_bgp_peer.html)
  - [`google_compute_shared_vpc_host_project`](https://www.terraform.io/docs/providers/google/r/compute_shared_vpc_host_project.html)
  - [`google_compute_shared_vpc_service_project`](https://www.terraform.io/docs/providers/google/r/compute_shared_vpc_service_project.html)
  - [`google_compute_subnetwork`](https://www.terraform.io/docs/providers/google/r/compute_subnetwork.html)
  - [`google_compute_subnetwork_iam_binding`](https://www.terraform.io/docs/providers/google/r/compute_subnetwork_iam.html)
  - [`google_compute_subnetwork_iam_member`](https://www.terraform.io/docs/providers/google/r/compute_subnetwork_iam.html)
  - [`google_compute_subnetwork_iam_policy`](https://www.terraform.io/docs/providers/google/r/compute_subnetwork_iam.html)
- Firebase
  - [`google_firebase_project`](https://www.terraform.io/docs/providers/google/r/firebase_project.html)
- Identity-Aware Proxy
  - [`google_iap_tunnel_instance_iam_binding`](https://www.terraform.io/docs/providers/google/r/iap_tunnel_instance_iam.html)
  - [`google_iap_tunnel_instance_iam_member`](https://www.terraform.io/docs/providers/google/r/iap_tunnel_instance_iam.html)
  - [`google_iap_tunnel_instance_iam_policy`](https://www.terraform.io/docs/providers/google/r/iap_tunnel_instance_iam.html)
- Kubernetes (Container) Engine
  - [`google_container_cluster`](https://www.terraform.io/docs/providers/google/r/container_cluster.html)
  - [`google_container_node_pool`](https://www.terraform.io/docs/providers/google/r/container_node_pool.html)
- Resource Manager
  - [`google_resource_manager_lien`](https://www.terraform.io/docs/providers/google/r/resource_manager_lien.html)
- Secret Manager
  - [`google_secret_manager_secret`](https://www.terraform.io/docs/providers/google/r/secret_manager_secret.html)
  - [`google_secret_manager_secret_version`](https://www.terraform.io/docs/providers/google/r/secret_manager_secret_version.html)
- Service Networking
  - [`google_service_networking_connection`](https://www.terraform.io/docs/providers/google/r/service_networking_connection.html)

### [GSuite](https://github.com/DeviaVir/terraform-provider-gsuite)

- [`gsuite_group`](https://github.com/DeviaVir/terraform-provider-gsuite/blob/master/gsuite/resource_group.go)
- [`gsuite_group_member`](https://github.com/DeviaVir/terraform-provider-gsuite/blob/master/gsuite/resource_group_member.go)

### [Helm](https://www.terraform.io/docs/providers/helm/index.html)

- [`helm_release`](https://www.terraform.io/docs/providers/helm/r/release.html)

### [Kubernetes](https://www.terraform.io/docs/providers/kubernetes/index.html)

- [`kubernetes_config_map`](https://www.terraform.io/docs/providers/kubernetes/r/config_map.html)
- [`kubernetes_namespace`](https://www.terraform.io/docs/providers/kubernetes/r/namespace.html)
- [`kubernetes_pod`](https://www.terraform.io/docs/providers/kubernetes/r/pod.html)
- [`kubernetes_role`](https://www.terraform.io/docs/providers/kubernetes/r/role.html)
- [`kubernetes_role_binding`](https://www.terraform.io/docs/providers/kubernetes/r/role_binding.html)
- [`kubernetes_service`](https://www.terraform.io/docs/providers/kubernetes/r/service.html)
- [`kubernetes_service_account`](https://www.terraform.io/docs/providers/kubernetes/r/service_account.html)

### [Kubernetes Provider (Alpha)](https://github.com/hashicorp/terraform-provider-kubernetes-alpha)

- [`kubernetes_manifest`](https://github.com/hashicorp/terraform-provider-kubernetes-alpha#create-a-kubernetes-custom-resource-definition)

### [Local](https://www.terraform.io/docs/providers/local/)

- **Unimportable**:
  - [`local_file`](https://www.terraform.io/docs/providers/local/r/file.html)

### [Null](https://www.terraform.io/docs/providers/null/)

- **Unimportable**:
  - [`null_resource`](https://www.terraform.io/docs/providers/null/resource.html)

### [Random](https://www.terraform.io/docs/providers/random/index.html)

- [`random_id`](https://www.terraform.io/docs/providers/random/r/id.html)
- [`random_integer`](https://www.terraform.io/docs/providers/random/r/integer.html)
- **Unimportable**:
  - [`random_password`](https://www.terraform.io/docs/providers/random/r/password.html)
  - [`random_pet`](https://www.terraform.io/docs/providers/random/r/pet.html)
  - [`random_shuffle`](https://www.terraform.io/docs/providers/random/r/shuffle.html)
  - [`random_string`](https://www.terraform.io/docs/providers/random/r/string.html)

### [TLS](https://www.terraform.io/docs/providers/tls/)

- **Unimportable**:
  - [`tls_private_key`](https://www.terraform.io/docs/providers/tls/r/private_key.html)
